<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>차유나 영양 관리</title>

    <!-- Open Graph / KakaoTalk Metadata -->
    <meta property="og:title" content="유나의 튼튼 식단 일기 🍎">
    <meta property="og:description" content="유나의 성장을 기록하고 영양을 관리하는 식단 일기입니다.">
    <meta property="og:image" content="{{ url_for('static', filename='og-image.jpg', _external=True) }}">
    <meta property="og:image:width" content="800">
    <meta property="og:image:height" content="400">
    <meta property="og:image:type" content="image/jpeg">
    <meta property="og:url" content="https://yuna-nutrition-tracker.onrender.com">
    <meta property="og:type" content="website">

    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link
        href="https://fonts.googleapis.com/css2?family=Jua&family=Outfit:wght@300;400;600;700&family=Noto+Sans+KR:wght@400;700&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="bg-decoration"></div>
    <div class="container">
        <header>
            <h1>유나의 튼튼 식단 일기 🍎</h1>
            <div id="profile-settings" class="profile-card">
                <span class="user-info">
                    차유나 <span id="d-day-display" class="badge-dday">D+??</span>
                    <span id="age-display" style="font-weight: bold; margin-left: 5px; color: #555;">(??개월 ??일)</span>
                    <input type="hidden" id="user-months" value="12">
                </span>
                <div style="display: flex; gap: 10px; align-items: center;">
                    <button id="open-settings" class="btn-small"
                        style="background: var(--primary-color); border: none; font-size: 1rem; cursor: pointer; border-radius: 20px; padding: 6px 15px; display: flex; align-items: center; justify-content: center; transition: all 0.3s; color: white; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.1);">⚙️
                        앱 설정</button>
                    <!-- 개월수는 자동 계산되므로 저장 버튼은 권장 칼로리 갱신용으로 유지하거나 향후 확장성을 위해 둡니다. -->
                    <button id="saveProfileBtn" class="btn-small" style="display:none;">저장</button>
                </div>
            </div>

            <div id="preference-settings" class="profile-card">
                <h4 style="font-family: var(--font-heading); color: var(--primary-color); margin-bottom: 8px;">유나의
                    음식 취향
                    😋</h4>
                <div class="pref-row">
                    <div class="pref-group">
                        <label>좋아해요! ✨</label>
                        <div id="likes-tags" class="tag-container"></div>
                        <input type="text" id="like-input" placeholder="좋아하는 음식 (엔터)">
                    </div>
                    <div class="pref-group">
                        <label>싫어해요! 😖</label>
                        <div id="dislikes-tags" class="tag-container"></div>
                        <input type="text" id="dislike-input" placeholder="싫어하는 음식 (엔터)">
                    </div>
                </div>
            </div>

            <nav class="navbar">
                <button class="nav-btn active" data-tab="meal">식단기록</button>
                <button class="nav-btn" data-tab="growth">성장일기</button>
            </nav>
        </header>

        <main>
            <!-- 대시보드 섹션 -->
            <section id="dashboard" class="card tab-meal">
                <h2>오늘의 영양소</h2>
                <div class="chart-container">
                    <canvas id="nutritionChart"></canvas>
                </div>
            </section>

            <!-- 성장 관리 섹션 -->
            <section id="growth-tracker" class="card tab-growth hidden">
                <h2 id="toggle-growth"
                    style="cursor: pointer; display: flex; justify-content: space-between; align-items: center; margin-bottom: 0;">
                    유나의 성장 일기 🦒
                    <span id="growth-toggle-icon" style="font-size: 1.2rem; transition: transform 0.3s;">▼</span>
                </h2>

                <div id="growth-content-wrapper">
                    <!-- Health tracker moved out of growth-container for visibility test -->
                    <div id="health-tracker" class="card"
                        style="margin: 15px; padding: 15px; background: #fff; border-radius: 15px; border: 1px solid #eee;">
                        <h3
                            style="display: flex; justify-content: space-between; align-items: center; font-size: 1.1rem; color: #008b8b; margin-bottom: 5px;">
                            🏥 영유아 검진 & 접종 일정
                            <button id="toggle-full-schedule" class="btn-small"
                                style="font-size: 0.8rem; padding: 4px 10px; background-color: var(--secondary-color);">전체
                                일정 보기</button>
                        </h3>
                        <div id="today-health-tasks" style="margin-top: 10px;">
                            <p class="empty-msg">Loading schedule...</p>
                        </div>

                        <div id="full-health-schedule" class="collapsed"
                            style="margin-top: 15px; border-top: 1px dashed #fab1a0; padding-top: 10px;">
                            <div id="full-schedule-list" class="schedule-container">
                            </div>
                        </div>
                    </div>

                    <div class="growth-container">
                        <form id="growthForm" class="compact-form">
                            <div class="form-row">
                                <div class="form-group flex-1">
                                    <label>현재 키(cm)</label>
                                    <input type="number" step="0.1" name="height" placeholder="예: 80.5" required>
                                </div>
                                <div class="form-group flex-1">
                                    <label>현재 몸무게(kg)</label>
                                    <input type="number" step="0.1" name="weight" placeholder="예: 10.2" required>
                                </div>
                                <div class="form-group flex-1">
                                    <button type="submit" class="btn-small" style="width: 100%;">기록</button>
                                </div>
                            </div>
                        </form>
                        <div id="growth-status" class="status-box">
                            아래 차트에서 유나의 성장 추세를 확인하세요.
                        </div>

                        <div style="margin: 15px 0;">
                            <button id="toggle-growth-history" class="btn-small"
                                style="width: 100%; background: var(--secondary-color);">성장 기록 현황 보러가기</button>
                        </div>
                        <div id="growth-history-list" class="growth-history-container"
                            style="display: none; margin-bottom: 20px;">
                            <!-- 성장 기록 목록이 여기에 렌더링됨 -->
                        </div>
                        <div class="chart-row" style="margin-top: 20px;">
                            <div class="chart-container" style="height: 250px; flex: 1; min-width: 280px;">
                                <canvas id="heightChart"></canvas>
                            </div>
                            <div class="chart-container" style="height: 250px; flex: 1; min-width: 280px;">
                                <canvas id="weightChart"></canvas>
                            </div>
                        </div>

                        <div id="growth-prediction-section" style="margin-top: 30px; margin-bottom: 25px;">
                            <h3
                                style="font-family: var(--font-heading); color: var(--primary-color); margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                                🔮 미래 성장 예측 (Age 2-20)
                            </h3>
                            <div class="prediction-scroll-container">
                                <div id="prediction-list" class="prediction-grid">
                                    <!-- JS로 예측 데이터 렌더링 -->
                                </div>
                            </div>
                            <p style="font-size: 0.75rem; color: #999; margin-top: 10px; text-align: center;">
                                * 현재 성장 백분위가 성인이 될 때까지 유지된다고 가정한 예측치입니다.
                            </p>
                        </div>
                        <button id="show-dev-info" class="btn-premium-action">
                            <span>📚 우리아기 발달 정보 보러가기</span>
                        </button>
                    </div>
                </div>
            </section>

            <!-- 캘린더 섹션 -->
            <section id="calendar-section" class="card tab-meal">
                <div class="calendar-header">
                    <button id="prevMonth" class="btn-icon">&lt;</button>
                    <h2 id="currentMonthYear">2026년 2월</h2>
                    <button id="nextMonth" class="btn-icon">&gt;</button>
                </div>
                <div class="calendar-grid-header">
                    <span>일</span><span>월</span><span>화</span><span>수</span><span>목</span><span>금</span><span>토</span>
                </div>
                <div id="calendar-body" class="calendar-grid">
                    <!-- JS로 렌더링 -->
                </div>
            </section>

            <section id="nutrition-summary" class="tab-meal">
                <!-- 자바스크립트로 데이터 로드 -->
            </section>

            <!-- 식사 기록 섹션 -->
            <section id="record-meal" class="card tab-meal">
                <h2>밥 먹었어요! 🍚</h2>
                <form id="mealForm" class="compact-form" style="background: none; border: none; padding: 0;">
                    <div class="form-row">
                        <div class="form-group flex-1">
                            <label for="mealType">언제?</label>
                            <select id="mealType" name="mealType">
                                <option value="아침">아침</option>
                                <option value="점심">점심</option>
                                <option value="저녁">저녁</option>
                                <option value="간식" selected>간식</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group flex-2">
                            <label>🍰 무엇을 먹었나요?</label>
                            <div style="display: flex; gap: 8px;">
                                <input type="text" name="menuName" id="ai-menu-name" placeholder="예: 소고기죽, 사과퓨레"
                                    required>
                                <button type="button" id="start-ai-analysis" class="btn-small"
                                    style="flex-shrink: 0; background: linear-gradient(135deg, #a29bfe, #6c5ce7); font-size: 0.8rem; padding: 10px 15px;">
                                    📸 AI 사진 분석
                                </button>
                            </div>
                            <input type="file" id="meal-photo-input" accept="image/*" style="display: none;">
                        </div>
                        <div class="form-group flex-1">
                            <label>😋 선호도</label>
                            <select name="preference">
                                <option value="비선호">비선호</option>
                                <option value="보통" selected>보통</option>
                                <option value="선호">선호</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row" style="display: none;">
                        <div class="form-group">
                            <label for="calories">칼로리(kcal)</label>
                            <input type="number" id="calories" name="calories" placeholder="자동 분석">
                        </div>
                        <div class="form-group">
                            <label for="carbs">탄수화물(g)</label>
                            <input type="number" id="carbs" name="carbs" placeholder="자동 분석">
                        </div>
                        <div class="form-group">
                            <label for="protein">단백질(g)</label>
                            <input type="number" id="protein" name="protein" placeholder="자동 분석">
                        </div>
                        <div class="form-group">
                            <label for="fat">지방(g)</label>
                            <input type="number" id="fat" name="fat" placeholder="자동 분석">
                        </div>
                    </div>
                    <p style="font-size: 0.8rem; color: #888; margin-top: -5px; margin-bottom: 10px; display: none;">*
                        영양소를 모르면
                        비워두세요.
                        유나가 대신 분석해줄게요! ✨</p>
                    <button type="submit" class="btn-premium-action" style="margin-top: 10px;">
                        <span>기록하기</span>
                    </button>
                </form>
            </section>

            <!-- 오늘 먹은 목록 -->
            <section id="meal-list-section" class="card tab-meal">
                <h2>오늘 이렇게 먹었어요 🍴</h2>
                <div id="meal-list">
                    <p class="empty-msg">아직 기록이 없어요.</p>
                </div>
            </section>

            <!-- 추천 섹션 -->
            <section id="recommendation" class="card tab-meal">
                <h2>다음 식사는 이게 어때요? 👩‍🍳</h2>
                <div id="recommendation-content">
                    <p>분석 중...</p>
                </div>
                <button id="speakBtn" class="btn-speak">🗣️ 말해줘!</button>
            </section>
        </main>
    </div>

    <!-- AI 로딩 오버레이 -->
    <div id="ai-loading" class="ai-overlay" style="display: none;">
        <div class="ai-loader-content">
            <div class="spinner"></div>
            <p>유나가 사진을 보고 있어요... ✨</p>
        </div>
    </div>
    <!-- 설정 모달 -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header"
                style="padding: 20px; border-bottom: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center;">
                <h3 style="font-size: 1.3rem; color: #333;">⚙️ 앱 설정</h3>
                <span class="close-modal" id="close-settings"
                    style="font-size: 2.4rem; font-weight: bold; cursor: pointer; color: #999; line-height: 1; display: inline-block; padding: 0 10px;">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group" style="margin-bottom: 20px;">
                    <label>🔑 Gemini API Key</label>
                    <p style="font-size: 0.8rem; color: #666; margin-bottom: 8px;">
                        AI 식단 분석 기능을 위해 필요합니다.
                        <a href="https://aistudio.google.com/app/apikey" target="_blank"
                            style="color: var(--secondary-color); text-decoration: underline;">여기에서 무료로 발급</a> 받으실 수
                        있습니다.
                    </p>
                    <input type="password" id="gemini-api-key-input" class="input-premium" placeholder="API 키를 입력하세요">
                </div>
                <button id="save-settings" class="btn-premium-action">
                    <span>설정 저장하기</span>
                </button>
            </div>
        </div>
    </div>
    <div id="dev-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>🦒 우리아기 성장 발달표</h2>
                <button class="close-btn" id="close-dev-modal">&times;</button>
            </div>
            <div id="dev-modal-body" class="modal-body">
                <!-- 개발 데이터가 여기에 동적으로 삽입됨 -->
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>

</html>